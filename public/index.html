<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="bg.css">
  <script src="test.js"></script>
</head>
  
<body>
  <div id="content">
  
  <div id="main">
  <h1 class="head">しりとり</h1>
  <p id="previousWord" class="word"></p>

  <input type="text" id="nextWordInput" placeholder="回答を入力" class="box">
  <input type="button" value="送信" id="nextWordSendButton" class="button"/>
  <button  id="resetButton" class="button2">リセット</button>
  <!-- <button onclick="reload()">ロード</button> -->

  </div>
  <nav>
    <p class = "rireki">過去の単語</p>
    <font size = 5><ul id="a"></ul></font>


  </nav>
  </div>
  <div class="bg_pattern Rhombus"></div>
  <div class="section"></div>

  <script type="module">

    // const word=[];

    window.onload = async (event) => {
        await fetch("/shiritori", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nextWord:"りんご"})
        });
 
        const response = await fetch("/shiritori");
        const previousWord = await response.text();
        const para = document.querySelector("#previousWord");
        para.innerText = `前の単語：${previousWord}`;

        // word.push(previousWord);

        document.getElementById('a').innerHTML = previousWord

        // //localStorageから取り出し
        // var grstatus2 = localStorage.getItem('word');
        // //取り出した後にJSON.parseをかけます。
        // grstatus2 = JSON.parse(grstatus2);
        // console.log(grstatus2);


        // for (var i = 0; i < grstatus2.length; i++) {
        // // // まず、idを表示する
        // // // Htmlのdivの部分を指定する
        // // var getData = document.getElementById('a');
        // // // 表示したいデータを指定する
        // // var arrayId = document.createTextNode(grstatus2[i]);
        // // // 要素を指定し、その要素の子要素としてデータを表示する
        // // getData.appendChild(arrayId);

        // var todoList = document.createElement('li'); 
        // todoList.textContent = grstatus2[i];
        // document.getElementById('a').appendChild(todoList);
        // }
         };

        
      //リセット
      document.querySelector("#resetButton").onclick = async (event) => {
        var result = window.confirm('リセットしますか？');
        if(result){
        const nextWord =1;
        const response = await fetch("/shiritori", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nextWord })
        });  

        const previousWord = await response.text();
        // const previousWord = "a";
        const para = document.querySelector("#previousWord");
        para.innerText = `前の単語：${previousWord}`;

        document.location.reload()
      }
      else{
        ;
      }

      };

        document.querySelector("#nextWordSendButton").onclick = async (event) => {

        const nextWord = document.querySelector("#nextWordInput").value;
        const response = await fetch("/shiritori", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nextWord })
        });

        if (response.status / 100 !== 2) {
        alert(await response.text());
        return;
        }
        // word.push(nextWord);
        // //JSON.stringifyした上で、localStorageに保存します。
        // localStorage.setItem('word', JSON.stringify(word));

        const previousWord = await response.text();
        const para = document.querySelector("#previousWord");
        para.innerText = `前の単語：${previousWord}`;

        //履歴表示
        var todoList = document.createElement('li'); 
        todoList.textContent = previousWord
        document.getElementById('a').appendChild(todoList);
        //formクリア
        var textForm = document.getElementById("nextWordInput");
        textForm.value = '';
        };

        </script>
</body>

</html>